#!/usr/bin/env python
# -*- coding: utf-8 -*-
# vim :set ft=py:

import sys
import blosc
import argparse

"""

TODO
----

* version string
* author licencse readme
* check for overwrite
* typesize and clevel
* error string
* files larger than memory
* print function

"""

EXTENSION = '.blp'

if __name__ == '__main__':
    parser = argparse.ArgumentParser(
            description='command line de/compression with blosc')
    parser.add_argument('file_', metavar='<file>', type=str, nargs=1,
                            help='file to be de/compressed')
    group = parser.add_mutually_exclusive_group()
    group.add_argument('-c', '--compress', action='store_true', dest='compress', default=True)
    group.add_argument('-d', '--decompress', action='store_true',
            dest='decompress', default=False)
    args = parser.parse_args()
    file_ = args.file_[0]

    if not args.decompress:
        with open(file_, 'rb') as input_file, \
                open(file_ + EXTENSION, 'wb') as output_file:
            plaintext = input_file.read()
            compressed = blosc.compress(plaintext, 4 ,clevel=9)
            output_file.write(compressed)
    else:
        if not file_.endswith(EXTENSION):
            print "files does not end with EXTENSION"
            sys.exit('3')
        with open(file_, 'rb') as input_file, \
                open(file_[:-4], 'wb') as output_file:
            plaintext = input_file.read()
            compressed = blosc.decompress(plaintext)
            output_file.write(compressed)
